<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Number Game Web</title>
<style>
body { font-family: Arial; text-align:center; background:#1e1e2f; color:white; }
h1 { margin-top:20px; }
#balance { font-size:22px; margin:15px 0; }
.btn { padding:15px 25px; margin:10px; font-size:18px; border:none; border-radius:10px; cursor:pointer; }
.btn:hover { opacity:0.8; }
.win { background:#4CAF50; }
.lose { background:#f44336; }
#history { margin-top:20px; font-size:16px; max-height:200px; overflow-y:auto; text-align:left; padding:0 20px; }
</style>
</head>
<body>

<h1>üé≤ Number Game</h1>
<div id="balance">Balance: ...</div>

<button class="btn win" onclick="joinGame()">Join Game</button>
<br>

<input type="number" id="num" placeholder="1-100" min="1" max="100">
<button class="btn lose" onclick="submitNumber()">Submit Number</button>

<div id="history"></div>

<script>
// ==== CONFIG ====
const API = "http://YOUR_SERVER_IP:5000"; // Replace with your Termux / server IP
const user_id = Math.floor(Math.random()*1000000); // For demo: random user ID
const chat_id = "demo_chat"; // single chat ID

// ==== STATE ====
let balance = 0;

// ==== FUNCTIONS ====
async function getBalance() {
    const res = await fetch(API+"/api/get_coins", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({user_id})
    });
    const data = await res.json();
    balance = data.coins;
    document.getElementById("balance").innerText = "Balance: "+balance;
}

async function joinGame() {
    const res = await fetch(API+"/api/join_game", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({user_id, chat_id})
    });
    const data = await res.json();
    let msg = "";
    if(data.status==="joined") msg = `‚úÖ Joined Game (${data.players} players)`;
    else if(data.status==="no_money") msg = "‚ùå Not enough coins";
    else msg = "‚ö† "+data.status;
    document.getElementById("history").innerHTML = msg;
    getBalance();
}

async function submitNumber() {
    const number = parseInt(document.getElementById("num").value);
    if(!number || number<1 || number>100){
        alert("Number must be 1-100"); return;
    }
    const res = await fetch(API+"/api/submit_number", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({user_id, chat_id, number})
    });
    const data = await res.json();
    if(data.status==="ended"){
        document.getElementById("history").innerHTML =
            `üèÜ Winner: ${data.winner}<br>Target: ${data.target}<br>Prize: ${data.prize}`;
    } else if(data.status==="already_submitted"){
        document.getElementById("history").innerHTML = "‚ö† Number already submitted";
    } else {
        document.getElementById("history").innerHTML = "‚úÖ Number submitted!";
    }
    getBalance();
}

// ==== INIT ====
getBalance();
</script>

</body>
</html>
